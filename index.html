<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ä‡∏°‡∏û‡∏π‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏ï‡πä‡∏∞</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: system-ui, "Noto Sans Thai", sans-serif; background: #f8fafc; margin: 0; }
    header { background: #ef5da8; color: white; padding: 16px; text-align: center; font-size: 20px; font-weight: bold; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px; padding: 20px; }
    .table-card { padding: 20px; border-radius: 12px; text-align: center; font-weight: bold; cursor: pointer; }
    .free { background: #d1fae5; color: #065f46; }
    .busy { background: #fee2e2; color: #991b1b; }
  </style>
</head>
<body>
  <header>‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ä‡∏°‡∏û‡∏π‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ ‚Ä¢ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏ï‡πä‡∏∞</header>
  <div class="grid" id="tables"></div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    // TODO: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡πÅ‡∏•‡∏∞ KEY ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Ñ‡∏∏‡∏ì
    const SUPABASE_URL = 'https://pklvscffpbapogezoxyn.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrbHZzY2ZmcGJhcG9nZXpveHluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1NTIxNTYsImV4cCI6MjA2NTEyODE1Nn0.O0cXyJAo0qdbNZsLqK1zpo1lS1H1mrudaGz2VaEQQaM';
    
    // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ client ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≥
    const client = createClient(SUPABASE_URL, SUPABASE_KEY);

    const tablesDiv = document.getElementById("tables");

    async function loadTables() {
      const { data, error } = await client.from("tables").select("*").order("id");
      if (error) {
        console.error(error);
        return;
      }
      tablesDiv.innerHTML = "";
      data.forEach(t => {
        const div = document.createElement("div");
        div.className = "table-card " + (t.status === "‡∏ß‡πà‡∏≤‡∏á" ? "free" : "busy");
        div.textContent = t.name + " (" + t.status + ")";
        div.onclick = () => {
          // üëâ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î ‡∏à‡∏∞‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ bill.html ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á table_id
          window.location.href = `bill.html?table_id=${t.id}`;
        };
        tablesDiv.appendChild(div);
      });
    }

    loadTables();

    // ‚úÖ Realtime subscribe
    client.channel('tables-changes')
      .on('postgres_changes', { event: '*', schema: 'public', table: 'tables' }, payload => {
        loadTables();
      })
      .subscribe();
  </script>
</body>
</html>
