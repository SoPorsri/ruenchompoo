<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>เรือนชมพู - บิลซื้อกลับบ้าน</title>
<link rel="stylesheet" href="bill.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body { font-family: Tahoma, sans-serif; }
#menuItems div {
  display:grid; grid-template-columns: 1fr 80px 80px; gap:8px; align-items:center;
  padding:6px 0; border-bottom:1px solid #eee;
}
#menuItems input {
  width:60px; text-align:right;
}
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
.floating-btn { position:fixed; bottom:20px; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; box-shadow:0 2px 4px rgba(0,0,0,.2);}
.floating-btn.left { left:20px; background:#ffb347; }
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const menu = [
    { name: "กิโล (กลับบ้าน)", price: 220 },
    { name: "ขีด (กลับบ้าน)", price: 22 },
    { name: "น้ำจิ้ม", price: 0 },
    { name: "วุ้นเส้น (ร้าน)", price: 20 },
    { name: "วุ้นเส้นถุง (ใหญ่)", price: 20 },
    { name: "วุ้นเส้นถุง (เล็ก)", price: 10 },
    { name: "เห็ดเข็ม (ถุง)", price: 20 },
    { name: "ข้าวโพด", price: 10 }
  ];

  const menuDiv = document.getElementById("menuItems");
  const grand = document.getElementById("grand");
  const cash = document.getElementById("cash");
  const change = document.getElementById("change");
  const today = document.getElementById("today");
  today.textContent = new Date().toLocaleDateString('th-TH');

  // โหลดจาก localStorage ถ้ามี
  let qtys = JSON.parse(localStorage.getItem("takehomeQtys") || "{}");

  // render เมนู
  menuDiv.innerHTML = menu.map((m,i)=>`
    <div>
      <div>${m.name}</div>
      <div class="right">${m.price ? m.price.toFixed(0) : "-"}</div>
      <input type="number" min="0" id="qty${i}" value="${qtys[i]||0}">
    </div>
  `).join("");

  function calc(){
    let total=0;
    qtys = {};
    menu.forEach((m,i)=>{
      const q = parseFloat(document.getElementById("qty"+i).value||0);
      qtys[i]=q;
      total += q * m.price;
    });
    grand.textContent = "฿" + total.toLocaleString('th-TH',{maximumFractionDigits:0});
    localStorage.setItem("takehomeQtys", JSON.stringify(qtys));
    const c = parseFloat(cash.value||0);
    change.value = c>0 ? (c-total).toLocaleString('th-TH',{maximumFractionDigits:0}) : '';
  }

  menu.forEach((m,i)=>document.getElementById("qty"+i).addEventListener("input",calc));
  cash.addEventListener("input",calc);
  calc();

  // ปุ่มพิมพ์
  document.getElementById("btnPrint").addEventListener("click", ()=>{
    document.getElementById("previewModal").style.display="flex";
    let html = `<table style='width:100%;font-size:13px;border-collapse:collapse'>
      <tr><th align='left'>สินค้า</th><th align='right'>จำนวน</th><th align='right'>ราคา</th></tr>`;
    menu.forEach((m,i)=>{
      const q = qtys[i]||0;
      if(q>0) html += `<tr><td>${m.name}</td><td align='right'>${q}</td><td align='right'>${(q*m.price).toFixed(0)}</td></tr>`;
    });
    html += `</table><hr><div align='right'><strong>${grand.textContent}</strong></div>`;
    document.getElementById("previewContent").innerHTML = html;
  });

  document.getElementById("btnCancelPreview").addEventListener("click",()=>{
    document.getElementById("previewModal").style.display="none";
  });

  document.getElementById("btnConfirmPrint").addEventListener("click",()=>{
    window.print();
    document.getElementById("previewModal").style.display="none";
  });
});
</script>
</head>

<body>
<div class="container">
  <div class="app">
    <header>
      <div>
        <div style="font-size:18px;font-weight:bold;">ร้านเรือนชมพูเนื้อย่างเกาหลี</div>
        <div class="muted">สาขานาเชือก • <small id="today"></small></div>
      </div>
      <button class="accent" id="btnPrint"><i class="fa-solid fa-print"></i> พิมพ์บิล</button>
    </header>

    <main>
      <h2 style="margin:0 0 10px 0">ซื้อกลับบ้าน</h2>
      <div id="menuItems"></div>
      <div class="summary" style="margin-top:12px;border-top:1px solid #ddd;padding-top:10px;">
        <div class="line"><span>ยอดรวม</span><span class="big" id="grand">฿0.00</span></div>
      </div>
      <div style="display:flex;gap:10px;margin-top:10px;">
        <input type="text" class="num" id="cash" placeholder="รับเงินมา (บาท)" inputmode="numeric">
        <input type="text" class="num" id="change" placeholder="เงินทอน" readonly>
      </div>
    </main>
  </div>
</div>

<!-- popup preview -->
<div id="previewModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:9999;">
  <div style="background:white; padding:20px; border-radius:12px; width:90%; max-width:500px; max-height:90%; overflow:auto;">
    <h2 style="margin-top:0">รายการซื้อกลับบ้าน</h2>
    <div style="margin-bottom:12px;font-size:13px;">
      <label><strong>เลือกวิธีการพิมพ์:</strong></label><br>
      <label style="margin-right:16px;"><input type="radio" name="printType" value="USB" checked> คอมพิวเตอร์</label>
      <label><input type="radio" name="printType" value="WIFI"> สมาร์ทโฟน</label>
    </div>
    <div id="previewContent"></div>
    <div style="margin-top:16px; display:flex; justify-content:flex-end; gap:8px;">
      <button id="btnCancelPreview" class="ghost">ยกเลิก</button>
      <button id="btnConfirmPrint" class="accent">ยืนยันพิมพ์</button>
    </div>
  </div>
</div>

<button id="btnHome" class="floating-btn left"><i class="fa-solid fa-house"></i> กลับหน้าหลัก</button>

<script>
document.getElementById("btnHome").addEventListener("click",()=>window.location.href="index.html");
</script>
</body>
</html>
